<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="/smart-video-app/" />
    <title>Installing Smart Video App…</title>
    <style>
      :root {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        color: #f4f4f5;
        background: #010101;
      }

      body {
        margin: 0;
        min-height: 80vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
        background: radial-gradient(circle at top, #18181b 0%, #010101 70%);
      }

      main {
        max-width: 32rem;
        width: 100%;
        border-radius: 1.25rem;
        padding: 2.5rem;
        background: #050505;
        border: 1px solid rgba(244, 244, 245, 0.1);
        box-shadow: 0 35px 80px rgba(0, 0, 0, 0.65);
        text-align: center;
      }

      h1 {
        margin-top: 0;
        font-size: 2rem;
        color: #fafafa;
      }

      p {
        color: #d4d4d8;
        margin-bottom: 0;
        line-height: 1.6;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Installing Smart Video App…</h1>
      <p>
        Smart Video uses Webflow's recommended OAuth install flow (Option A), so the authorization
        code exchange and script injection happen automatically during the redirect.
      </p>
      <p data-status>
        Waiting for Webflow to finish the OAuth callback and return you to the dashboard. You can
        close this tab if you are redirected already.
      </p>
    </main>
    <script type="module">
      const STATUS = document.querySelector("[data-status]");
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      const siteId = params.get("site_id") ?? params.get("siteId");
      const state = params.get("state");

      if (!code && !siteId && !state) {
        if (STATUS) {
          STATUS.textContent =
            "This screen is shown only after approving Smart Video inside Webflow. Please relaunch the Smart Video app from the Webflow Apps directory to start the install.";
        }
      } else if (STATUS) {
        let message =
          "Received secure redirect from Webflow. Completing token exchange and injecting the Smart Video script via the Webflow Custom Code API.";
        if (code) {
          const redacted = `${code.slice(0, 4)}…${code.slice(-4)}`;
          message += ` Authorization code ${redacted} captured.`;
        }
        if (siteId) {
          message += ` Install requested for site ${siteId}.`;
        }
        if (state) {
          message += ` State parameter ${state} recorded.`;
        }
        message +=
          " Once complete you'll be redirected straight back to your Webflow dashboard with Smart Video active on all published pages.";
        STATUS.textContent = message;
      }
    </script>
  </body>
</html>
