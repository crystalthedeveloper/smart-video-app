<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="/smart-video-app/" />
    <title>Installing Smart Video App…</title>
    <style>
      :root {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #020617;
        color: #e2e8f0;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 2rem;
      }

      main {
        max-width: 32rem;
        width: 100%;
        border-radius: 1rem;
        padding: 2.25rem;
        background: rgba(15, 23, 42, 0.9);
        box-shadow: 0 35px 60px rgba(2, 6, 23, 0.45);
        text-align: center;
      }

      h1 {
        margin-top: 0;
        font-size: 2rem;
      }

      p {
        color: #cbd5f5;
        margin-bottom: 0;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Installing Smart Video App…</h1>
      <p data-status>
        Waiting for Webflow to complete the install. Please launch Smart Video from the Webflow Apps
        interface if you aren't redirected automatically.
      </p>
    </main>
    <script type="module">
      const STATUS = document.querySelector("[data-status]");
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      const siteId = params.get("site_id") ?? params.get("siteId");
      const state = params.get("state");

      if (!code && !siteId && !state) {
        if (STATUS) {
          STATUS.textContent =
            "This page should only load after approving the Smart Video App in Webflow. Please return to the Webflow Apps directory to start the install.";
        }
      } else if (STATUS) {
        let message = "Received redirect from Webflow.";
        if (code) {
          const redacted = `${code.slice(0, 4)}…${code.slice(-4)}`;
          message += ` Authorization code ${redacted} captured.`;
        }
        if (siteId) {
          message += ` Install requested for site ${siteId}.`;
        }
        if (state) {
          message += ` State parameter ${state} recorded.`;
        }
        message += " You can close this tab and return to Webflow to finish setup.";
        STATUS.textContent = message;
      }
    </script>
  </body>
</html>
